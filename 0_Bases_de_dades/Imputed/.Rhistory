load("C:/Users/mdrhu/Treball_Mineria_de_Dades/0_Bases_de_dades/Imputed/data_NA_imputed_AREG.RData")
data = data_imputed_AREG[,-7]
# Boxplots
numeric_vars <- setdiff(names(data)[sapply(data, is.numeric)], "Exited")
num_plots <- lapply(numeric_vars, function(var) {
ggplot(data, aes(x = Exited, y = .data[[var]], fill = Exited)) +
geom_boxplot() +
labs(title = var, x = NULL, y = NULL) +
theme_minimal() +
theme(legend.position = "none",
plot.title = element_text(hjust = 0.5, size = 10))
})
num_panel <- wrap_plots(num_plots, ncol = 3) +
plot_annotation(title = "Boxplots de variables numéricas vs Exited")
library(glmnet)
library(car)
library(ggplot2)
library(scales)
library(patchwork)
library(dplyr)
data = data_imputed_AREG[,-7]
# Boxplots
numeric_vars <- setdiff(names(data)[sapply(data, is.numeric)], "Exited")
num_plots <- lapply(numeric_vars, function(var) {
ggplot(data, aes(x = Exited, y = .data[[var]], fill = Exited)) +
geom_boxplot() +
labs(title = var, x = NULL, y = NULL) +
theme_minimal() +
theme(legend.position = "none",
plot.title = element_text(hjust = 0.5, size = 10))
})
num_panel <- wrap_plots(num_plots, ncol = 3) +
plot_annotation(title = "Boxplots de variables numéricas vs Exited")
num_panel
# Kruskal - wallis =========================================
kruskal_results <- lapply(numeric_vars, function(var) {
# fórmula: variable ~ Exited
formula <- as.formula(paste("Exited ~ ", var))
test <- kruskal.test(formula, data = data)
data.frame(
Variable = var,
Statistic = test$statistic,
p_value = test$p.value,
stringsAsFactors = FALSE
)
})
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(kruskal_results)
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(kruskal_results)
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
kruskal_results <- lapply(numeric_vars, function(var) {
# fórmula: variable ~ Exited
formula <- as.formula(paste("Exited ~ ", var))
test <- kruskal.test(formula, data = data)
data.frame(
Variable = var,
Statistic = test$statistic,
p_value = test$p.value,
stringsAsFactors = FALSE
)
})
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(kruskal_results)
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
View(kruskal_table)
View(kruskal_results)
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(kruskal_results)
kruskal_results <- lapply(numeric_vars, function(var) {
# fórmula: variable ~ Exited
formula <- as.formula(paste("Exited ~ ", var))
test <- kruskal.test(formula, data = data)
data.frame(
Variable = var,
Statistic = test$statistic,
p_value = test$p.value,
stringsAsFactors = FALSE
)
})
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(kruskal_results)
kruskal_results = as.data.frame(table)
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(table)
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
kruskal_results = as.data.frame(kruskal_table)
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(kruskal_table)
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
kruskal_table <- kruskal_table[order(kruskal_table$p_value), ]
kruskal_table <- as.data.frame(do.call(rbind, kruskal_results))
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
View(kruskal_table)
kruskal_results = as.data.frame(kruskal_table)
kruskal_results <- lapply(numeric_vars, function(var) {
# fórmula: variable ~ Exited
formula <- as.formula(paste("Exited ~ ", var))
test <- kruskal.test(formula, data = data)
data.frame(
Variable = var,
Statistic = test$statistic,
p_value = test$p.value,
stringsAsFactors = FALSE
)
})
kruskal_table <- do.call(rbind, kruskal_results)
kruskal_results = as.data.frame(kruskal_table)
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
kruskal_table <- kruskal_table[order(kruskal_table$p_value), ]
kruskal_table
# Test indep cat =========================================
# Lista de variables categóricas
cat_var <- setdiff(names(data)[sapply(data, is.factor)], "Exited")
# Aplicamos chi-square
chisq_results <- lapply(categorical_vars, function(var) {
tbl <- table(data[[var]], data$Exited)
# Verificamos si hay celdas esperadas < 5
expected <- chisq.test(tbl)$expected
test_used <- if(any(expected < 5)) "Fisher" else "Chi-squared"
if(test_used == "Chi-squared"){
test <- suppressWarnings(chisq.test(tbl))
} else {
test <- fisher.test(tbl)
}
data.frame(
Variable = var,
Test = test_used,
Statistic = ifelse(test_used == "Chi-squared", test$statistic, NA),
p_value = test$p.value,
stringsAsFactors = FALSE
)
})
# Aplicamos chi-square
chisq_results <- lapply(cat_vars, function(var) {
tbl <- table(data[[var]], data$Exited)
# Verificamos si hay celdas esperadas < 5
expected <- chisq.test(tbl)$expected
test_used <- if(any(expected < 5)) "Fisher" else "Chi-squared"
if(test_used == "Chi-squared"){
test <- suppressWarnings(chisq.test(tbl))
} else {
test <- fisher.test(tbl)
}
data.frame(
Variable = var,
Test = test_used,
Statistic = ifelse(test_used == "Chi-squared", test$statistic, NA),
p_value = test$p.value,
stringsAsFactors = FALSE
)
})
# Test indep cat =========================================
# Lista de variables categóricas
cat_vars <- setdiff(names(data)[sapply(data, is.factor)], "Exited")
# Aplicamos chi-square
chisq_results <- lapply(cat_vars, function(var) {
tbl <- table(data[[var]], data$Exited)
# Verificamos si hay celdas esperadas < 5
expected <- chisq.test(tbl)$expected
test_used <- if(any(expected < 5)) "Fisher" else "Chi-squared"
if(test_used == "Chi-squared"){
test <- suppressWarnings(chisq.test(tbl))
} else {
test <- fisher.test(tbl)
}
data.frame(
Variable = var,
Test = test_used,
Statistic = ifelse(test_used == "Chi-squared", test$statistic, NA),
p_value = test$p.value,
stringsAsFactors = FALSE
)
})
chisq_table <- do.call(rbind, chisq_results)
chisq_table <- chisq_table[order(chisq_table$p_value), ]
chisq_table
# GLM ========================================================
formula_glm <- as.formula(paste("Exited ~", paste(setdiff(names(data), "Exited"), collapse = " + ")))
modelo_glm <- glm(formula_glm, data = data, family = binomial)
summary(modelo_glm)
chisq_table
chisq_table %>% filter(p_value > 0.05)
kruskal_table #VARIABLES DETECTADAS KRUSKAL
kruskal_results %>% select(Variable, p_value) %>% where(p_value > 0.05)
kruskal_table <- kruskal_table[order(kruskal_table$p_value), ]
kruskal_table %>% filter(p_value > 0.05) #VARIABLES DETECTADAS KRUSKAL
## LASSO (L1) ====================================================
# Crea matriz de diseño (sin intercept)
x <- model.matrix(Exited ~ ., data = data)[, -1]
# Variable respuesta binaria (glmnet la requiere numérica 0/1)
y <- as.numeric(data$Exited) - 1  # convierte factor {1,2} a {0,1}
set.seed(123)
cv_lasso <- cv.glmnet(
x, y,
alpha = 1,               # 1 = LASSO
family = "binomial",     # regresión logística
nfolds = 10
)
View(x)
## LASSO (L1) ====================================================
# Crea matriz de diseño (sin intercept)
x <- model.matrix(Exited ~ ., data = data)[, -1]
## LASSO (L1) ====================================================
# Crea matriz de diseño (sin intercept)
x <- model.matrix(Exited ~ ., data = data)
chisq_table %>% filter(p_value > 0.05) #VARIABLES DETECTADAS INDEP
kruskal_table %>% filter(p_value > 0.05) #VARIABLES DETECTADAS KRUSKAL
kruskal_table %>% filter(p_value > 0.05) #VARIABLES DETECTADAS KRUSKAL
summary(modelo_glm)
coef(modelo_glm)
p_values(modelo_glm)
summary(modelo_glm)
# Variable respuesta binaria (glmnet la requiere numérica 0/1)
y <- as.numeric(data$Exited) - 1  # convierte factor {1,2} a {0,1}
set.seed(123)
cv_lasso <- cv.glmnet(
x, y,
alpha = 1,               # 1 = LASSO
family = "binomial",     # regresión logística
nfolds = 10
)
## LASSO (L1) ====================================================
# Crea matriz de diseño (sin intercept)
x <- model.matrix(Exited ~ ., data = data)
View(data)
modelo_glm <- glm(formula_glm, data = data[-17], family = binomial)
# GLM ========================================================
formula_glm <- as.formula(paste("Exited ~", paste(setdiff(names(data[-17]), "Exited"), collapse = " + ")))
modelo_glm <- glm(formula_glm, data = data[-17], family = binomial)
summary(modelo_glm)
## LASSO (L1) ====================================================
# Crea matriz de diseño (sin intercept)
x <- model.matrix(Exited ~ ., data = data[-17])
# Variable respuesta binaria (glmnet la requiere numérica 0/1)
y <- as.numeric(data$Exited) - 1  # convierte factor {1,2} a {0,1}
set.seed(123)
cv_lasso <- cv.glmnet(
x, y,
alpha = 1,               # 1 = LASSO
family = "binomial",     # regresión logística
nfolds = 10
)
# Lambda óptimo
lambda_opt <- cv_lasso$lambda.min
cat("Lambda óptimo seleccionado:", lambda_opt, "\n")
coef_matrix <- coef(cv_lasso, s = "lambda.min")
lasso_coefs <- as.data.frame(as.matrix(coef_matrix))
colnames(lasso_coefs) <- "Estimate"
lasso_coefs$Variable <- rownames(lasso_coefs)
lasso_coefs <- lasso_coefs[order(-abs(lasso_coefs$Estimate)), ]  # ordenar por magnitud
print(lasso_coefs)
print(lasso_coefs)
summary(modelo_glm)
# GLM ========================================================
formula_glm <- as.formula(paste("Exited ~ 0 +", paste(setdiff(names(data[-17]), "Exited"), collapse = " + ")))
modelo_glm <- glm(formula_glm, data = data[-17], family = binomial)
summary(modelo_glm)
print(lasso_coefs)
summary(modelo_glm)
chisq_table %>% filter(p_value > 0.05) #VARIABLES DETECTADAS INDEP
kruskal_table %>% filter(p_value > 0.05) #VARIABLES DETECTADAS KRUSKAL
