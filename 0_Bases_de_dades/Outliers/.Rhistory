data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(data$Exited)
Index <- sample(1:nrow(data), size = nrow(data)*0.8)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain[,"Exited"]
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest[,"Exited"]
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, train_matrix, valid, nrounds = 1000)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- sample(1:nrow(data), size = nrow(data)*0.8)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain[,"Exited"]
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest[,"Exited"]
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, train_matrix, valid, nrounds = 1000)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- sample(1:nrow(data), size = nrow(data)*0.8)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain[,"Exited"]
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest[,"Exited"]
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = valid, nrounds = 1000)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- sample(1:nrow(data), size = nrow(data)*0.8)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain[,"Exited"]
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest[,"Exited"]
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = valid, nrounds = 1000)
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
View(train_matrix)
View(train_m)
train_m@x
View(train_label)
View(valid)
View(test_m)
View(test_label)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain[,"Exited"]
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest[,"Exited"]
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain[,"Exited"]
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest[,"Exited"]
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
train_label <- as.vector(dataTrain[,"Exited"])
View(train_label)
train_label <- as.vector(dataTrain$Exited)
test_label <- dataTest$Exited
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain$Exited
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest$Exited
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
View(bst)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'f1score')
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
custom_eval <- function(preds, dtrain) {
# obtener etiquetas reales
labels <- getinfo(dtrain, "label")
# convertir predicciones a clases 0/1
preds_class <- ifelse(preds > 0.5, 1, 0)
# calcular F1
tp <- sum(preds_class == 1 & labels == 1)
fp <- sum(preds_class == 1 & labels == 0)
fn <- sum(preds_class == 0 & labels == 1)
f1 <- if ((tp + fp + fn) == 0) 0 else (2 * tp) / (2 * tp + fp + fn)
return(list(name = "f1", value = f1, higher_better = TRUE))
}
f1score <- function(preds, dtrain) {
# obtener etiquetas reales
labels <- getinfo(dtrain, "label")
# convertir predicciones a clases 0/1
preds_class <- ifelse(preds > 0.5, 1, 0)
# calcular F1
tp <- sum(preds_class == 1 & labels == 1)
fp <- sum(preds_class == 1 & labels == 0)
fn <- sum(preds_class == 0 & labels == 1)
f1 <- if ((tp + fp + fn) == 0) 0 else (2 * tp) / (2 * tp + fp + fn)
return(list(name = "f1", value = f1, higher_better = TRUE))
}
bst <- lightgbm(params = params, data = train_matrix,
valids = list(test = test_matrix), nrounds = 1000, eval = f1score)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain$Exited
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest$Exited
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = "binary_logloss")
f1score <- function(preds, dtrain) {
# obtener etiquetas reales
labels <- getinfo(dtrain, "label")
# convertir predicciones a clases 0/1
preds_class <- ifelse(preds > 0.5, 1, 0)
# calcular F1
tp <- sum(preds_class == 1 & labels == 1)
fp <- sum(preds_class == 1 & labels == 0)
fn <- sum(preds_class == 0 & labels == 1)
f1 <- if ((tp + fp + fn) == 0) 0 else (2 * tp) / (2 * tp + fp + fn)
return(list(name = "f1", value = f1, higher_better = TRUE))
}
bst <- lightgbm(params = params, data = train_matrix,
valids = list(test = test_matrix), nrounds = 1000, eval = f1score)
bst <- lightgbm(params = params, data = train_matrix,
valids = list(test = test_matrix), nrounds = 1000, eval_fun = f1score)
bst <- lightgbm(params = params, data = train_matrix,
valids = list(test = test_matrix), nrounds = 1000, feval = f1score)
# library(pacman)
# pacman::p_load(pscl, ggplot2, ROCR, lightgbm, methods, Matrix, caret, dplyr)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain$Exited
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest$Exited
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
#prediction & confusion matrix
p <- predict(bst, test_m)
test$Predicted <- ifelse(p > 0.5, 1, 0)
#prediction & confusion matrix
p <- predict(bst, test_m)
dataTest$Predicted <- ifelse(p > 0.5, 1, 0)
confusionMatrix(factor(dataTest$Predicted), factor(dataTest$Exited))
dataTest$Predicted <- ifelse(p > 0.2, 1, 0)
confusionMatrix(factor(dataTest$Predicted), factor(dataTest$Exited))
pred=prediction(p,dataTest$Exited)
roc=performance(pred,"tpr","fpr")
plot(roc,main="ROC curve")
plot(roc,main="ROC curve")
abline(a=0,b=1)
roc
View(roc)
auc <- performance(pred, mesure = "auc")
auc <- performance(pred, measure = "auc")
auc
auc@y.values
f1 <- function(data, lev = NULL, model = NULL) {
f1_val <- MLmetrics::F1_Score(y_pred = data$pred, y_true = data$obs, positive = "Yes")
c(F1 = f1_val)
}
results <- data.frame(
pred = pred,
obs  = dataTest$Exited
)
results <- data.frame(
pred = p,
obs  = dataTest$Exited
)
(f1_val <- f1(data = results))
results <- data.frame(
pred = dataTest$Predicted,
obs  = dataTest$Exited
)
(f1_val <- f1(data = results))
# library(pacman)
# pacman::p_load(pscl, ggplot2, ROCR, lightgbm, methods, Matrix, caret, dplyr)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain$Exited
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest$Exited
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
# library(pacman)
# pacman::p_load(pscl, ggplot2, ROCR, lightgbm, methods, Matrix, caret, dplyr)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain$Exited
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest$Exited
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
bst <- lightgbm(params = params, data = train_matrix, valids = list(test = test_matrix), nrounds = 1000)
#prediction & confusion matrix
p <- predict(bst, test_m)
dataTest$Predicted <- ifelse(p > 0.2, 1, 0)
confusionMatrix(factor(dataTest$Predicted), factor(dataTest$Exited))
pred <- prediction(p,dataTest$Exited)
roc <- performance(pred,"tpr","fpr")
auc <- performance(pred, measure = "auc")
plot(roc,main="ROC curve")
abline(a=0,b=1)
auc@y.values
f1 <- function(data, lev = NULL, model = NULL) {
f1_val <- MLmetrics::F1_Score(y_pred = data$pred, y_true = data$obs, positive = "Yes")
c(F1 = f1_val)
}
results <- data.frame(
pred = dataTest$Predicted,
obs  = dataTest$Exited
)
(f1_val <- f1(data = results))
# library(pacman)
# pacman::p_load(pscl, ggplot2, ROCR, lightgbm, methods, Matrix, caret, dplyr)
set.seed(123)
load("dataAREG_outliers.RData")
data <- dataAREG
data$DigitalEngagementScore <- factor(data$DigitalEngagementScore)
data$CustomerSegment <- factor(data$CustomerSegment)
data$NetPromoterScore <- factor(data$NetPromoterScore)
data$Exited <- as.numeric(as.character(data$Exited))
Index <- createDataPartition(data$Exited, p = 0.8, list = FALSE)
dataTrain <- data[Index, ]
dataTest  <- data[-Index, ]
seleccio = c("Age","IsActiveMember","MaritalStatus","EstimatedSalary",
"SavingsAccountFlag","NumOfProducts","Gender","AvgTransactionAmount",
"Geography","EducationLevel","HasCrCard", "Exited")
dataTrain <- dataTrain %>%
select(seleccio)
dataTest <- dataTest %>%
select(seleccio)
train_m <- sparse.model.matrix(Exited ~., data = dataTrain)
train_label <- dataTrain$Exited
test_m <- sparse.model.matrix(Exited ~., data = dataTest)
test_label <- dataTest$Exited
train_matrix <- lgb.Dataset(data = as.matrix(train_m), label = train_label)
test_matrix <- lgb.Dataset(data = as.matrix(test_m), label = test_label)
valid <- list(test = test_matrix)
# model parameters
params <- list(max_bin = 5,
learning_rate = 0.001,
objective = "binary",
metric = 'binary_logloss')
#prediction & confusion matrix
p <- predict(bst, test_m)
dataTest$Predicted <- ifelse(p > 0.2, 1, 0)
confusionMatrix(factor(dataTest$Predicted), factor(dataTest$Exited))
pred <- prediction(p,dataTest$Exited)
roc <- performance(pred,"tpr","fpr")
auc <- performance(pred, measure = "auc")
plot(roc,main="ROC curve")
abline(a=0,b=1)
auc@y.values
f1 <- function(data, lev = NULL, model = NULL) {
f1_val <- MLmetrics::F1_Score(y_pred = data$pred, y_true = data$obs, positive = "Yes")
c(F1 = f1_val)
}
results <- data.frame(
pred = dataTest$Predicted,
obs  = dataTest$Exited
)
(f1_val <- f1(data = results))
f1_val <- MLmetrics::F1_Score(y_pred = data$pred, y_true = data$obs, positive = 1)
f1 <- function(data, lev = NULL, model = NULL) {
f1_val <- MLmetrics::F1_Score(y_pred = data$pred, y_true = data$obs, positive = 1)
c(F1 = f1_val)
}
results <- data.frame(
pred = dataTest$Predicted,
obs  = dataTest$Exited
)
(f1_val <- f1(data = results))
